<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACI Mock Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        header {
            background-color: #0056b3;
            color: #fff;
            padding: 15px 0;
            text-align: center;
            margin-bottom: 20px;
        }
        header h1 {
            margin: 0;
            font-weight: 300;
        }
        .section {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h2 {
            color: #0056b3;
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Sección de Generación */
        #generate-section form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
         #generate-section .form-group {
             display: flex;
             flex-direction: column;
         }
        #generate-section label {
            font-weight: 700;
            margin-bottom: 5px;
        }
        #generate-section input[type="text"],
        #generate-section select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }
         #generate-section input[type="text"].full-width {
             grid-column: span 2; /* Tema ocupa dos columnas */
         }
        #generate-section button {
            grid-column: span 2; /* Botón ocupa dos columnas */
            padding: 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #generate-section button:hover {
            background-color: #218838;
        }

        /* Sección de Lista de Artículos */
        #articles-list ul {
            list-style: none;
            padding: 0;
        }
        #articles-list li {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #articles-list li .article-info {
            flex-grow: 1;
        }
         #articles-list li h3 {
             margin: 0 0 5px 0;
             color: #007bff;
             font-size: 1.1em;
             border-bottom: none;
             padding-bottom: 0;
         }
         #articles-list li p {
             margin: 0;
             font-size: 0.9em;
             color: #555;
         }
        #articles-list li .article-actions a {
            margin-left: 10px;
            text-decoration: none;
            color: #007bff;
        }
         #articles-list li .article-actions a:hover {
             text-decoration: underline;
         }

        /* Sección de Revisión/Edición (Simulada) */
        #review-section {
             /* Por defecto oculta, se mostraría al hacer clic en un artículo */
             display: none; /* Ocultar por defecto */
        }
         #review-section .article-title-review {
             font-family: 'Roboto', sans-serif; /* Usar fuente del body */
             color: #333;
             text-align: center;
             margin-bottom: 20px;
         }
        #review-section .editor-area textarea {
            width: 100%;
            min-height: 400px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            margin-bottom: 15px;
            box-sizing: border-box; /* Asegurar padding no aumenta el ancho */
        }
         #review-section .image-preview-area {
             text-align: center;
             margin-bottom: 20px;
         }
         #review-section .image-preview-area img {
             max-width: 300px; /* Tamaño fijo para la preview en el mock */
             height: auto;
             border: 1px solid #eee;
             border-radius: 4px;
             box-shadow: 0 2px 5px rgba(0,0,0,0.1);
         }
         #review-section .chat-area {
             border-top: 1px solid #eee;
             margin-top: 20px;
             padding-top: 20px;
         }
         #review-section .chat-log {
             border: 1px solid #ccc;
             min-height: 150px;
             max-height: 300px;
             overflow-y: auto;
             padding: 10px;
             border-radius: 4px;
             margin-bottom: 10px;
         }
         #review-section .chat-log div {
             margin-bottom: 8px;
         }
         #review-section .chat-log .user-message {
             text-align: right;
             color: #007bff;
         }
         #review-section .chat-log .ai-message {
             text-align: left;
             color: #28a745;
         }
         #review-section .chat-input textarea {
             width: 100%;
             min-height: 60px;
             padding: 10px;
             border: 1px solid #ccc;
             border-radius: 4px;
             font-size: 1em;
             box-sizing: border-box;
             margin-bottom: 10px;
         }
         #review-section .chat-input button {
             display: block;
             width: 100%;
             padding: 10px;
             background-color: #007bff;
             color: white;
             border: none;
             border-radius: 4px;
             font-size: 1em;
             cursor: pointer;
             transition: background-color 0.3s ease;
         }
         #review-section .chat-input button:hover {
             background-color: #0056b3;
         }

        /* Sección Explorar DB (Simulada) */
        #explore-db-section ul {
            list-style: disc;
            padding-left: 20px;
        }
        #explore-db-section li {
             margin-bottom: 5px;
        }
        #explore-db-section li a {
             color: #007bff;
             text-decoration: none;
        }
        #explore-db-section li a:hover {
             text-decoration: underline;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            #generate-section form {
                grid-template-columns: 1fr; /* Una columna en pantallas pequeñas */
            }
             #generate-section input[type="text"].full-width,
             #generate-section button {
                 grid-column: span 1;
             }
        }
    </style>
</head>
<body>
    <header>
        <h1>Asistente de Contenido Inteligente (ACI)</h1>
    </header>

    <div class="container">

        <!-- Sección 1: Solicitar Generación de Artículo -->
        <section id="request-generation-section" class="section">
            <h2>Solicitar Nueva Generación de Artículo</h2>
            <form id="request-generate-form">
                <div class="form-group full-width">
                    <label for="request-topic">Tema:</label>
                    <input type="text" id="request-topic" placeholder="Ej: Futuro de la exploración espacial" class="full-width">
                </div>
                <!-- Opcional: Podríamos añadir un campo para configuracion_id si quisiéramos permitirlo desde aquí -->
                <button type="submit">Solicitar Generación</button>
            </form>
            <div id="request-response" style="margin-top: 15px;"></div>
        </section>

        <!-- Sección 2: Tareas de Generación -->
        <section id="tasks-section" class="section">
            <h2>Tareas de Generación</h2>
            <div style="margin-bottom: 15px;">
                <label for="task-status-filter">Filtrar por estado:</label>
                <select id="task-status-filter">
                    <option value="">Todos</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="en_progreso">En Progreso</option>
                    <option value="completado">Completado</option>
                    <option value="error">Error</option>
                </select>
                <button onclick="fetchGenerationTasks()">Cargar Tareas</button>
            </div>
            <p id="loading-tasks" style="display: none;">Cargando tareas...</p>
            <table id="generation-tasks-table" style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th>ID Tarea</th>
                        <th>Tema</th>
                        <th>Estado</th>
                        <th>Fecha Solicitud</th>
                        <th>Fecha Actualización</th>
                        <th>ID Artículo Generado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Las filas de tareas se insertarán aquí -->
                </tbody>
            </table>
            <p id="no-tasks" style="display: none;">No hay tareas para mostrar.</p>
        </section>

        <!-- Sección 3: Artículos Generados (Listado General) -->
        <section id="articles-list" class="section">
            <h2>Artículos Generados</h2>
            <button onclick="fetchAllArticles()">Cargar Todos los Artículos</button>
            <p id="loading-articles" style="display: none;">Cargando artículos...</p>
            <ul id="generated-articles-list">
                <!-- Los artículos se listarán aquí -->
            </ul>
            <p id="no-articles-message" style="display: none;">No hay artículos generados.</p>
        </section>

        <!-- Sección 4: Configuración por Tema -->
        <section id="config-section" class="section">
            <h2>Configuración por Tema</h2>
            <div>
                <label for="config-tema-load">Cargar configuración para el Tema:</label>
                <input type="text" id="config-tema-load" placeholder="Nombre del tema">
                <button onclick="loadConfigForTopic()">Cargar Config</button>
            </div>
            <div id="config-fields" style="margin-top:15px;">
                <form id="config-form">
                    <input type="hidden" id="config-id"> <!-- Para mantener el ID si se está editando -->
                    <div class="form-group"><label for="config-tema">Tema:</label><input type="text" id="config-tema" required></div>
                    <div class="form-group"><label for="min_score_fuente">Min Score Fuente (Scraper):</label><input type="number" id="min_score_fuente" value="5"></div>
                    <div class="form-group"><label for="num_fuentes_scraper"># Fuentes (Scraper):</label><input type="number" id="num_fuentes_scraper" value="10"></div>
                    <div class="form-group"><label for="min_score_generador">Min Score Fuente (Generador):</label><input type="number" id="min_score_generador" value="7"></div>
                    <div class="form-group"><label for="num_fuentes_generador"># Fuentes (Generador):</label><input type="number" id="num_fuentes_generador" value="3"></div>
                    <div class="form-group"><label for="num_imagenes_buscar"># Imágenes a Buscar:</label><input type="number" id="num_imagenes_buscar" value="2"></div>

                    <div class="form-group full-width"><label for="prompt_analyzer_template">Prompt Analyzer Template (Opcional):</label><textarea id="prompt_analyzer_template" rows="3"></textarea></div>
                    <div class="form-group full-width"><label for="prompt_generator_template">Prompt Generator Template (Opcional):</label><textarea id="prompt_generator_template" rows="5"></textarea></div>
                    <!-- Añadir más campos de config si es necesario: longitud_texto, tono_texto, prompt_copilot_template -->
                    <button type="submit">Guardar Configuración</button>
                </form>
            </div>
            <div id="config-response" style="margin-top: 15px;"></div>
            <hr>
            <h3>Temas con Configuración Existente</h3>
            <button onclick="loadAvailableTopics()">Listar Temas con Config</button>
            <ul id="available-topics-list"></ul>
        </section>

        <!-- Sección de Revisión/Edición (Oculta por defecto) -->
        <section id="review-section" class="section" style="display: none;">
             <button onclick="hideReviewSection();" style="float: right; background-color: #ccc; color: #333; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer;">Cerrar</button>
             <h2 id="review-article-title">Revisar Artículo:</h2>
             <p id="review-article-meta" style="text-align: center; color: #555; margin-bottom: 20px;"></p>
             <input type="hidden" id="review-article-id">

             <div class="image-preview-area">
                 <h3>Imagen Principal</h3>
                 <img id="review-article-image" src="https://via.placeholder.com/300x200?text=Imagen" alt="Imagen del artículo">
                 <div id="review-article-images-gallery"></div>
             </div>

             <div class="editor-area">
                 <h3>Contenido del Artículo (Markdown)</h3>
                 <textarea id="review-body-editor" rows="15"></textarea>
                 <h3>Título:</h3>
                 <input type="text" id="review-title-editor" style="width:100%; padding:8px; margin-bottom:10px;">
                 <h3>Meta Descripción:</h3>
                 <textarea id="review-meta_description-editor" rows="3" style="width:100%; padding:8px; margin-bottom:10px;"></textarea>
                 <h3>Tags (separadas por coma):</h3>
                 <input type="text" id="review-tags-editor" style="width:100%; padding:8px; margin-bottom:10px;">
                 <h3>Estado:</h3>
                 <select id="review-estado-editor">
                    <option value="generado">Generado</option>
                    <option value="pendiente_revision">Pendiente Revisión</option>
                    <option value="publicado">Publicado</option>
                    <option value="descartado">Descartado</option>
                 </select>
                 <button onclick="saveArticleChanges()">Guardar Cambios del Artículo</button>
             </div>
             <div id="review-save-response" style="margin-top:10px;"></div>
        </section>

    </div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000'; // Asegúrate que coincida con tu API

        // --- Sección 1: Solicitar Generación de Artículo ---
        document.getElementById('request-generate-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const topic = document.getElementById('request-topic').value;
            const responseDiv = document.getElementById('request-response');
            responseDiv.textContent = '';

            if (!topic) {
                responseDiv.textContent = "Por favor, ingresa un tema.";
                responseDiv.style.color = 'red';
                return;
            }

            try {
                responseDiv.textContent = "Solicitando generación...";
                responseDiv.style.color = 'blue';
                const response = await fetch(`${API_BASE_URL}/dashboard/generar-articulo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tema: topic })
                });
                const data = await response.json();
                if (response.ok) {
                    responseDiv.textContent = `Solicitud enviada. Tarea ID: ${data.tarea_id}`;
                    responseDiv.style.color = 'green';
                    document.getElementById('request-topic').value = ''; // Limpiar campo
                    fetchGenerationTasks(); // Actualizar lista de tareas
                } else {
                    responseDiv.textContent = `Error: ${data.detail || response.statusText}`;
                    responseDiv.style.color = 'red';
                }
            } catch (error) {
                responseDiv.textContent = `Error de red: ${error.message}`;
                responseDiv.style.color = 'red';
            }
        });

        // --- Sección 2: Tareas de Generación ---
        async function fetchGenerationTasks() {
            const statusFilter = document.getElementById('task-status-filter').value;
            const loadingP = document.getElementById('loading-tasks');
            const noTasksP = document.getElementById('no-tasks');
            const tbody = document.querySelector('#generation-tasks-table tbody');

            loadingP.style.display = 'block';
            noTasksP.style.display = 'none';
            tbody.innerHTML = ''; // Limpiar tabla

            try {
                let url = `${API_BASE_URL}/dashboard/tareas-generacion?limit=50`;
                if (statusFilter) {
                    url += `&estado=${statusFilter}`;
                }
                const response = await fetch(url);
                const tasks = await response.json();

                if (tasks.length === 0) {
                    noTasksP.style.display = 'block';
                } else {
                    tasks.forEach(task => {
                        const row = tbody.insertRow();
                        row.insertCell().textContent = task.id;
                        row.insertCell().textContent = task.tema;
                        row.insertCell().textContent = task.estado;
                        row.insertCell().textContent = new Date(task.fecha_solicitud).toLocaleString();
                        row.insertCell().textContent = task.fecha_actualizacion ? new Date(task.fecha_actualizacion).toLocaleString() : '-';
                        row.insertCell().textContent = task.articulo_generado_id || '-';

                        const actionsCell = row.insertCell();
                        if (task.estado === 'completado' && task.articulo_generado_id) {
                            const reviewButton = document.createElement('button');
                            reviewButton.textContent = 'Revisar Artículo';
                            reviewButton.onclick = () => loadArticleForReview(task.articulo_generado_id);
                            actionsCell.appendChild(reviewButton);
                        } else if (task.estado === 'error' && task.mensaje_error) {
                            const errorButton = document.createElement('button');
                            errorButton.textContent = 'Ver Error';
                            errorButton.onclick = () => alert(`Error Tarea ${task.id}:\n${task.mensaje_error}`);
                            actionsCell.appendChild(errorButton);
                        }
                    });
                }
            } catch (error) {
                noTasksP.textContent = `Error al cargar tareas: ${error.message}`;
                noTasksP.style.display = 'block';
            } finally {
                loadingP.style.display = 'none';
            }
        }
        // Cargar tareas al inicio
        fetchGenerationTasks();


        // --- Sección 3: Artículos Generados (Listado General) ---
        async function fetchAllArticles() {
            const listUl = document.getElementById('generated-articles-list');
            const loadingP = document.getElementById('loading-articles');
            const noArticlesP = document.getElementById('no-articles-message');
            loadingP.style.display = 'block';
            noArticlesP.style.display = 'none';
            listUl.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/articles`);
                const articles = await response.json();
                if (articles.length === 0) {
                    noArticlesP.style.display = 'block';
                } else {
                    articles.forEach(article => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="article-info">
                                <h3>${article.titulo} (ID: ${article.id})</h3>
                                <p>Tema: ${article.tema} | Generado: ${new Date(article.fecha_generacion).toLocaleDateString()} | Estado: ${article.estado}</p>
                            </div>
                            <div class="article-actions">
                                <button onclick="loadArticleForReview(${article.id})">Revisar/Editar</button>
                            </div>`;
                        listUl.appendChild(li);
                    });
                }
            } catch (error) {
                noArticlesP.textContent = `Error al cargar artículos: ${error.message}`;
                noArticlesP.style.display = 'block';
            } finally {
                loadingP.style.display = 'none';
            }
        }


        // --- Sección 4: Configuración por Tema ---
        async function loadConfigForTopic() {
            const tema = document.getElementById('config-tema-load').value;
            const responseDiv = document.getElementById('config-response');
            responseDiv.textContent = '';
            if (!tema) {
                responseDiv.textContent = 'Por favor, ingresa un tema para cargar su configuración.';
                responseDiv.style.color = 'orange';
                return;
            }
            try {
                const response = await fetch(`${API_BASE_URL}/config/${tema}`);
                const config = await response.json();
                if (response.ok) {
                    document.getElementById('config-tema').value = config.tema || tema; // Usar el tema de la config o el buscado
                    document.getElementById('min_score_fuente').value = config.min_score_fuente || 5;
                    document.getElementById('num_fuentes_scraper').value = config.num_fuentes_scraper || 10;
                    document.getElementById('min_score_generador').value = config.min_score_generador || 7;
                    document.getElementById('num_fuentes_generador').value = config.num_fuentes_generador || 3;
                    document.getElementById('num_imagenes_buscar').value = config.num_imagenes_buscar || 2;
                    document.getElementById('prompt_analyzer_template').value = config.prompt_analyzer_template || '';
                    document.getElementById('prompt_generator_template').value = config.prompt_generator_template || '';
                    // document.getElementById('config-id').value = config.id || ''; // Si tuvieras un ID de config
                    responseDiv.textContent = `Configuración para '${tema}' cargada.`;
                    responseDiv.style.color = 'green';
                } else {
                    responseDiv.textContent = `No se encontró configuración para '${tema}' o hubo un error: ${config.detail || response.statusText}. Se muestran valores por defecto.`;
                    responseDiv.style.color = 'orange';
                    // Cargar defaults en el form si no se encontró
                    document.getElementById('config-tema').value = tema;
                    document.getElementById('min_score_fuente').value = 5;
                    // ... y así para los demás campos ...
                }
            } catch (error) {
                responseDiv.textContent = `Error de red al cargar config: ${error.message}`;
                responseDiv.style.color = 'red';
            }
        }

        document.getElementById('config-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const responseDiv = document.getElementById('config-response');
            const configData = {
                tema: document.getElementById('config-tema').value,
                min_score_fuente: parseInt(document.getElementById('min_score_fuente').value) || 0,
                num_fuentes_scraper: parseInt(document.getElementById('num_fuentes_scraper').value) || 0,
                min_score_generador: parseInt(document.getElementById('min_score_generador').value) || 0,
                num_fuentes_generador: parseInt(document.getElementById('num_fuentes_generador').value) || 0,
                num_imagenes_buscar: parseInt(document.getElementById('num_imagenes_buscar').value) || 0,
                prompt_analyzer_template: document.getElementById('prompt_analyzer_template').value || null,
                prompt_generator_template: document.getElementById('prompt_generator_template').value || null,
            };

            if (!configData.tema) {
                responseDiv.textContent = "El campo 'Tema' es obligatorio para guardar la configuración.";
                responseDiv.style.color = 'red';
                return;
            }

            try {
                responseDiv.textContent = "Guardando configuración...";
                responseDiv.style.color = 'blue';
                const response = await fetch(`${API_BASE_URL}/config`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(configData)
                });
                const data = await response.json();
                if (response.ok) {
                    responseDiv.textContent = `Configuración para '${configData.tema}' guardada exitosamente.`;
                    responseDiv.style.color = 'green';
                    loadAvailableTopics(); // Actualizar lista de temas con config
                } else {
                    responseDiv.textContent = `Error al guardar: ${data.detail || response.statusText}`;
                    responseDiv.style.color = 'red';
                }
            } catch (error) {
                responseDiv.textContent = `Error de red al guardar config: ${error.message}`;
                responseDiv.style.color = 'red';
            }
        });

        async function loadAvailableTopics() {
            const listUl = document.getElementById('available-topics-list');
            listUl.innerHTML = 'Cargando...';
            try {
                const response = await fetch(`${API_BASE_URL}/temas-secciones`);
                const topics = await response.json();
                listUl.innerHTML = '';
                if (topics.length === 0) {
                    listUl.innerHTML = '<li>No hay temas con configuración guardada.</li>';
                } else {
                    topics.forEach(topic => {
                        const li = document.createElement('li');
                        li.textContent = topic;
                        listUl.appendChild(li);
                    });
                }
            } catch (error) {
                listUl.innerHTML = `<li>Error al cargar temas: ${error.message}</li>`;
            }
        }
        loadAvailableTopics(); // Cargar al inicio


        // --- Sección de Revisión/Edición ---
        async function loadArticleForReview(articleId) {
            document.getElementById('articles-list').style.display = 'none';
            document.getElementById('tasks-section').style.display = 'none'; // Ocultar tareas también
            document.getElementById('review-section').style.display = 'block';

            const responseDiv = document.getElementById('review-save-response');
            responseDiv.textContent = 'Cargando artículo...';
            responseDiv.style.color = 'blue';

            try {
                const response = await fetch(`${API_BASE_URL}/articles/${articleId}`);
                const article = await response.json();

                if (response.ok) {
                    document.getElementById('review-article-id').value = article.id;
                    document.getElementById('review-article-title').textContent = `Revisar Artículo: ${article.titulo}`;
                    document.getElementById('review-article-meta').textContent = `Tema: ${article.tema} | ID: ${article.id} | Generado: ${new Date(article.fecha_generacion).toLocaleString()}`;

                    document.getElementById('review-title-editor').value = article.titulo || '';
                    document.getElementById('review-meta_description-editor').value = article.meta_description || '';
                    document.getElementById('review-tags-editor').value = Array.isArray(article.tags) ? article.tags.join(', ') : (article.tags || '');
                    document.getElementById('review-body-editor').value = article.body || '';
                    document.getElementById('review-estado-editor').value = article.estado || 'generado';

                    const imagesGallery = document.getElementById('review-article-images-gallery');
                    imagesGallery.innerHTML = ''; // Limpiar galería
                    if (article.imagenes && article.imagenes.length > 0) {
                        document.getElementById('review-article-image').src = article.imagenes[0].url;
                        document.getElementById('review-article-image').alt = article.imagenes[0].alt_text || article.titulo;
                        // Si hay más imágenes, mostrarlas en la galería
                        article.imagenes.forEach(img => {
                            const imgElem = document.createElement('img');
                            imgElem.src = img.url;
                            imgElem.alt = img.alt_text || 'Imagen relacionada';
                            imgElem.style.maxWidth = '100px'; imgElem.style.maxHeight = '100px'; imgElem.style.margin = '5px';
                            imagesGallery.appendChild(imgElem);
                        });
                    } else {
                        document.getElementById('review-article-image').src = 'https://via.placeholder.com/300x200?text=No+Imagen';
                        document.getElementById('review-article-image').alt = 'No hay imagen disponible';
                    }
                    responseDiv.textContent = 'Artículo cargado.';
                    responseDiv.style.color = 'green';
                } else {
                    responseDiv.textContent = `Error al cargar artículo ${articleId}: ${article.detail || response.statusText}`;
                    responseDiv.style.color = 'red';
                }
            } catch (error) {
                responseDiv.textContent = `Error de red al cargar artículo: ${error.message}`;
                responseDiv.style.color = 'red';
            }
        }

        function hideReviewSection() {
            document.getElementById('review-section').style.display = 'none';
            document.getElementById('articles-list').style.display = 'block'; // O la sección que corresponda
            document.getElementById('tasks-section').style.display = 'block';
        }

        async function saveArticleChanges() {
            const articleId = document.getElementById('review-article-id').value;
            const responseDiv = document.getElementById('review-save-response');
            if (!articleId) {
                responseDiv.textContent = "No hay ID de artículo para guardar.";
                responseDiv.style.color = 'red';
                return;
            }

            const updatedData = {
                titulo: document.getElementById('review-title-editor').value,
                meta_description: document.getElementById('review-meta_description-editor').value,
                tags: document.getElementById('review-tags-editor').value.split(',').map(tag => tag.trim()).filter(tag => tag), // Convertir a lista
                body: document.getElementById('review-body-editor').value,
                estado: document.getElementById('review-estado-editor').value
            };

            try {
                responseDiv.textContent = "Guardando cambios...";
                responseDiv.style.color = 'blue';
                const response = await fetch(`${API_BASE_URL}/articles/${articleId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });
                const data = await response.json();
                if (response.ok) {
                    responseDiv.textContent = `Artículo ID ${articleId} actualizado exitosamente.`;
                    responseDiv.style.color = 'green';
                    fetchGenerationTasks(); // Actualizar lista de tareas por si el estado cambió
                    fetchAllArticles(); // Actualizar lista de artículos
                } else {
                    responseDiv.textContent = `Error al guardar: ${data.detail || response.statusText}`;
                    responseDiv.style.color = 'red';
                }
            } catch (error) {
                responseDiv.textContent = `Error de red al guardar: ${error.message}`;
                responseDiv.style.color = 'red';
            }
        }

    </script>
</body>
</html>